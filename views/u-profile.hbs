<head>
    <link rel="stylesheet" href="/css/u-profile.css">
    <link rel="stylesheet" href="/css/messages.css">
    <script src="/js/jquery-3.2.1.js"></script>
    <title>{{f_name}}'s Account | Town Hall</title>
</head>
<body>
    <section class="left-bar center bold">
        <figure class="avatar center block-center">
            <div class="avatarDiv">
                <img id="avatar" src="/img/png/avatar.png" alt="Name's Avatar">
            </div>
        </figure><br>
        <div id="avatarText">
            {{f_name}} | @{{username}}
        </div>
        <br>
        <div>
            {{state}} State
        </div>
        <br>
        <div>
            <a href="/logout/u">Logout</a>
        </div>
    </section>
    <section class="main">
        <button class="tabBtn active" id="tabBtn">Your Feed <span></span></button><span>&nbsp;</span><button class="tabBtn" id="tabBtn">Town Hall</button>
        <section id="feed" class="tabSect">
            <div class="messagesDiv">
                {{#if sourceSel}}
                {{#if messages}}
                {{#if auto_sug}}
                <div id="auto-sug" class="sug-orgs">
                <h4 class="center">Organisations &amp; Freelance Journalists you may want to follow</h4>
                <div class="right"><span id="close">X</span></div>
                {{#each sug_sources}}
                    {{#if organisation}}
                    <div class="sug-org">
                        <figure class="sug-org-logo">
                            <img src="/{{logo}}" class="sug-org-logo-img" alt="{{name}}'s Logo" title="{{name}}">
                        </figure>
                        <div class="sug-org-dets center bold">
                            <p><a href="/users/o/{{username}}">{{name}}</a></p>
                            <p>{{followersNo}}</p>
                            <button class="follow-btn" id="follow-btn" onclick="follow('{{username}}', 'org');">Follow</button>
                        </div>
                    </div>
                    {{else}}
                    <div class="sug-org">
                        <figure class="sug-org-logo">
                            <img src="/{{avatar}}" class="sug-org-logo-img" alt="{{name}}'s Logo" title="{{name}}">
                        </figure>
                        <div class="sug-org-dets center bold">
                            <p><a href="/users/o/{{username}}">{{name}}</a></p>
                            <p>{{followersNo}}</p>
                            <button class="follow-btn" id="follow-btn" onclick="follow('{{username}}', 'j');">Follow</button>
                        </div>
                    </div>
                    {{/if}}
                {{/each}}
                </div>
                {{/if}}
                {{#each messages}}
                <div class="message">
                    <div class="m-avatar">
                        <img src="/{{sender_avatar}}" class="m-avatar-img" alt="{{sender_name}}'s avatar">
                    </div>
                    <div class="m-sender">
                        <div class="m-sender-line"><a href="/users/{{sender}}">{{sender_name}}</a>{{#if verified}}<span class="verified"><img src="/img/img-1/success.png" title="Verified User" alt="Verified User"></span>{{/if}}</div>
                        <div class="m-sender-line">{{sender_position}}</div>
                    </div>
                    <div class="m-text">
                    {{message}}
                    </div>
                    <div class="m-info center">
                        <img src="/img/png/chat-1.png" class="item" title="Conversation" alt="Conversation"> ({{comments_no}})
                        <img src="/img/img-1/flag.png" class="item" title="Report" alt="Report">
                        <span class="item grey">{{time_created}} | {{date_created}}</span>
                    </div>
                </div>
                {{/each}}
                {{else}}
                <div class="center grey">You have no posts from the Organisations you follow</div>
                {{/if}}
                {{else}}
                <div id="no-prior" class="center grey">Follow an organisation to keep up with your Legislators</div>
                <h4 class="center">Organisations that report on your Legislators</h4>
                {{#if suggested_orgs}}
                <div class="sug-orgs">
                {{#each suggested_orgs}}
                    <div class="sug-org">
                        <figure class="sug-org-logo">
                            <img src="/{{logo}}" class="sug-org-logo-img" alt="{{name}}'s Logo" title="{{name}}">
                        </figure>
                        <div class="sug-org-dets center bold">
                            <p><a href="/users/o/{{username}}">{{name}}</a></p>
                            <p>{{followersNo}}</p>
                            <button class="follow-btn" id="follow-btn" onclick="follow('{{username}}', 'org');">Follow</button>
                        </div>
                    </div>
                {{/each}}
                </div>
                {{else}}
                <div class="center grey bold">
                    Unfortunately, at this time, we have no Organisations that report on your Legislators.
                    <br><br>
                    We're working with more media organisations to ensure that you are duly informed.
                    <br><br>
                    We'll inform you when a news organisation begins covering your District.
                </div>
                {{/if}}
                {{/if}}
            </div>
        </section>
        <section id="hall" class="tabSect hidden">
            <form action="javascript:void()" class="center" method="get">
                <input type="search" name="terms" id="searchBox" placeholder="Search Town Hall">
            </form>
            {{#each thMessages}}
            <div class="message">
                <div class="m-avatar">
                    <img src="/{{sender_avatar}}" class="m-avatar-img" alt="{{sender_name}}'s avatar">
                </div>
                <div class="m-sender">
                    <div class="m-sender-line"><a href="/users/{{sender}}">{{sender_name}}</a>{{#if verified}}<span class="verified"><img src="/img/img-1/success.png" title="Verified User" alt="Verified User"></span>{{/if}}</div>
                    <div class="m-sender-line">{{sender_position}}</div>
                </div>
                <div class="m-text">
                {{message}}
                </div>
                <div class="m-info center">
                    <img src="/img/png/chat-1.png" class="item" title="Conversation" alt="Conversation"> ({{comments_no}})
                    <img src="/img/img-1/flag.png" class="item" title="Report" alt="Report">
                    <span class="item grey">{{time_created}} | {{date_created}}</span>
                </div>
            </div>
            {{/each}}
        </section>
    </section>
    <section class="right-bar">
        <section class="tabBar">
            <h4 class="center black">Your Representatives</h4>
            {{#rep}}
            <div class="rep">
                <figure>
                    <img src="{{avatar}}" alt="{{full_name}}'s Avatar" class="rep_avatar">
                </figure>
                <figcaption class="center">
                    <a href="/users/l/{{code}}">{{type_exp}} {{full_name}}</a>
                </figcaption>
            </div>
            {{/rep}}
            <hr>
            {{#sen}}
            <div class="rep">
                <figure>
                    <img src="{{avatar}}" alt="{{full_name}}'s Avatar" class="rep_avatar">
                </figure>
                <figcaption class="center">
                    <a href="/users/l/{{code}}">{{type_exp}} {{full_name}}</a>
                </figcaption>
            </div>
            {{/sen}}
        </section>
        <section class="tabBar hidden">
            <h4 class="center">Trends</h4>
            <ol class="trends">
                <li class="trend"><a href="/">The First</a></li>
                <li class="trend"><a href="/">The Second</a></li>
                <li class="trend"><a href="/">The Third</a></li>
            </ol>
        </section>
    </section>
    <script>
        //changing tabs
        let tabs = document.getElementsByClassName('tabBtn');
        let sects = document.getElementsByClassName('tabSect');
        let bars = document.getElementsByClassName('tabBar');
        let active = 1;
        let tab1 = tabs[0];
        let sect1 = sects[0];
        let bar1 = bars[0];
        let tab2 = tabs[1];
        let sect2 = sects[1];
        let bar2 = bars[1];

        tab1.addEventListener('click', ()=>{
            if (active !== 1){
                tab2.className = 'tabBtn';
                sect1.className = 'tabSect';
                bar1.className = 'tabBar';
                sect2.classList += ' hidden';
                tab1.classList += ' active';
                bar2.classList += ' hidden';
                active = 1;
            }
        });
        tab2.addEventListener('click', ()=>{
            if(active !== 2){
                tab1.className = 'tabBtn';
                sect2.className = 'tabSect';
                bar2.className = 'tabBar';
                sect1.classList += ' hidden';
                tab2.classList += ' active';
                bar1.classList += ' hidden';
                active = 2;
            }
        });

        // Follow org
        function follow(username, org_type){
            $.ajax({
                url: '/follow/u/'+org_type+'/'+username,
                method: 'POST',
                error: ()=>{
                    alert("An error occured. Please check your Internet connection");
                },
                success: (data)=>{
                    if(data.success){
                        location.reload(true);
                    }
                    else {
                        alert(data.error);
                    }
                }
            });
        }

        $('#close').on('click', ()=>{
            document.getElementById('auto-sug').classList += ' hidden';
        });

        {{!-- tab2.click(); --}}
    </script>
</body>